# render.yaml

# Define the services (backend and database)
services:
  # 1. The Database (MongoDB)
  - type: pserv
    name: fix-buddy-db
    plan: free # Use 'standard' or higher for production
    # mongoDBVersion: "7.0"  <-- DELETED THIS INVALID LINE

  # 2. The Backend (Node.js Web Service)
  - type: web
    name: fix-buddy-api
    plan: free # Use 'standard' or higher for production
    runtime: node
    rootDir: backend
    buildFilter:
      paths:
      - backend/**
    buildCommand: npm install
    startCommand: npm start
    envVars:
      - key: MONGODB_URI
        fromService:
          type: pserv
          name: fix-buddy-db
          property: connectionString
      - key: FRONTEND_URL
        fromService:
          type: static # <-- FIXED THIS (was 'staticSite')
          name: fix-buddy-app
          property: url
      - key: GEMINI_API_KEY
        sync: false # Set this in the Render dashboard
      - key: YOUTUBE_API_KEY
        sync: false # Set this in the Render dashboard
      - key: SECRET
        sync: false # Set this in the Render dashboard

# 3. The Frontend (React Static Site)
# This top-level block is correct.
staticSites:
  - name: fix-buddy-app
    plan: free
    rootDir: frontend
    buildFilter:
      paths:
      - frontend/**
    buildCommand: npm install && npm run build
    publishDir: dist
    envVars:
      - key: VITE_API_BASE_URL
        fromService:
          type: web
          name: fix-buddy-api
          property: url